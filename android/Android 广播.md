# Android 广播

## 类型

- 显式广播

发送的Intent是显示Intent的广播。通过指定Intent组件名称来实现的，它一般用在知道目标组件名称的前提下，去调用以下方法。意图明确，指定了要激活的组件是哪个组件，一般是在相同的应用程序内部实现的。

- 隐式广播

通过Intent Filter来实现的，它一般用在没有明确指出目标组件名称的前提下。Android系统会根据隐式意图中设置的动作(action)、类别(category)、数据（URI和数据类型）找到最合适的组件来处理这个意图。一般是用于在不同应用程序之间。

## 机制

- 普通广播

普通广播是完全异步的，通过Context的sendBroadcast()方法来发送，消息传递效率比较高，但所有receivers（接收器）的执行顺序不确定。缺点是：接收者不能将处理结果传递给下一个接收者，并且无法终止广播Intent的传播，直到没有与之匹配的广播接收器为止。
- 有序广播
有序广播通过Context.sendOrderedBroadcast()来发送，所有的广播接收器优先级依次执行，广播接收器的优先级通过receiver的intent-filter中的android:priority属性来设置，数值越大优先级越高。

当广播接收器接收到广播后，可以使用setResult()函数来结果传给下一个广播接收器接收，然后通过getResult()函数来取得上个广播接收器接收返回的结果。
- 系统广播



## 注册

- 静态注册

静态注册是常驻型 ，也就是说当应用程序关闭后，如果有信息广播来，程序也会被系统调用自动运行。

- 动态注册

动态注册广播不是 常驻型广播 ，也就是说广播跟随activity的生命周期。

## 原理

> Android中的广播使用了设计模式中的观察者模式：基于消息的发布/订阅事件模型，不过，同时利用消息队列+Handler机制实现广播的线性化（保证广播不会丢失）

![img](http://xhrong.github.io/2017/08/09/Android%20Broadcast%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/1502265387429.jpg)

- **广播接收者** 通过 Binder机制在 AMS 注册
- **广播发送者** 通过 Binder 机制向 AMS 发送广播
- AMS 根据 广播发送者 要求，在已注册列表中，寻找合适的广播接收者
- AMS将广播发送到合适的广播接收者相应的消息循环队列中；
- 广播接收者通过 消息循环（Handler） 拿到此广播，并回调 onReceive()
- 特别注意：广播发送者和广播接收者的执行是**异步的**，发出去的广播不会关心有无接收者接收，也不确定接收者到底是何时才能接收到；



------

[]: http://xhrong.github.io/2017/08/09/Android%20Broadcast%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/	"Android Broadcast原理解析"

