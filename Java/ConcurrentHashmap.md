# ConcurrentHashmap

> HashMap`的线程安全版本，可以用来替换`HashTable`。在hash碰撞过多的情况下会将链表转化成红黑树。1.8版本的`ConcurrentHashMap`的实现与1.7版本有很大的差别，放弃了*段锁*的概念，借鉴了`HashMap`的数据结构：数组＋链表＋红黑树。

## CAS

在ConcurrentHashMap中，大量使用了U.compareAndSwapXXX的方法，这个方法是利用一个CAS算法实现无锁化的修改值的操作，他可以大大降低锁代理的性能消耗。CAS可以大大降低锁代理的性能消耗。这个算法的基本思想就是不断地去比较当前内存中的变量值与你指定的一个变量值是否相等，如果相等，则接受你指定的修改的值，否则拒绝你的操作。因为当前线程中的值已经不是最新的值，你的修改很可能会覆盖掉其他线程修改的结果。这一点与**乐观锁**，SVN的思想是比较类似的。